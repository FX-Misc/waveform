<link rel="import" href="bower_components/polymer/polymer.html">

<dom-module id="marker-element">
<style type="text/css">
:host {
position: absolute;
top: 0px;
left: 0px;
height: 100%;
width: 100%;
overflow: hidden;
}
</style>
<template><svg></svg></template>
<script>
"use strict";

Polymer({
	is: 'marker-element',
	properties:{
		state: {
			type: Object,
			value: null,
			notify: true
		}
	},
	observers: [
		'_update_svg(state.*)'
	],
	_update_svg: function(){
		this.debounce('update', function(){
			let svg;
			if(!this.state){
				svg = ""; 
			} else if (this.state.kind === "line"){

			let r = 3;

			// text background from: http://stackoverflow.com/a/31013492/2399799

			svg = `<svg style='pointer-events:none;position:absolute;left:0px;top:0px;' xmlns='http://www.w3.org/2000/svg' version='1.1'>
						<defs>
							<filter x="-10%" y="0" width="120%" height="1" id="solid">
								<feFlood flood-color="black"/>
								<feComposite in="SourceGraphic"/>
							</filter>
						</defs>

						<line x1='${this.state.x1}' y1='${this.state.y1}' x2='${this.state.x2}' y2='${this.state.y2}' stroke='black' stroke-width='3'/>
						<line x1='${this.state.x1}' y1='${this.state.y1}' x2='${this.state.x2}' y2='${this.state.y2}' stroke='white' stroke-width='1'/>
						<circle cx='${this.state.x1}' cy='${this.state.y1}' r='${r}' stroke='black' stroke-width='2' fill='white'/>
					    <circle cx='${this.state.x2}' cy='${this.state.y2}' r='${r}' stroke='black' stroke-width='2' fill='white'/>
					    <text filter="url(#solid)" x='${this.state.x1/2 + this.state.x2/2}' y='${this.state.y1/2 + this.state.y2/2}' fill="white" style='font-size:10px'> ${this.state.label} </text>
					</svg>`;
			} else {
				throw "unrecognised marker kind: " + this.state.kind;
			}

			Polymer.dom(this.root).innerHTML = svg;
			Polymer.dom.flush();
		});
	}
});
</script>
</dom-module>