<!--
CUSTOM ELEMENT: rm-plots
BY: DM

This is designed to be used inside a tile-wall element.  The "groups" array of the tilewall should be bound
to this element's "groups" property.  Then whenever the tilewall's groups array is spliced this element will
be notified and can update ratemaps acordingly, with the tilewall be notified of the updates.

-->


<link rel="import" href="bower_components/polymer/polymer.html">


<dom-module id="rm-plots">

<template></template>


<script>
	"use strict";
    Polymer({
    	is:'rm-plots',
    	properties: {
			cm_per_spa_bin: {
				type: Number,
				value: 2
			},
			smoothing_spa_bins: {
				type: Number,
				value: 2
			},
			max_rate_spa: {
				type: Number,
				value: -1
			},
			deg_per_dir_bin: {
				type: Number,
				value: 6
			},
			smoothing_dir_bins: {
				type: Number,
				value: 2
			},
    		groups: {
    			type: Array,
    			value: function(){return [];},
    			notify: true
    		}
    	},
    	observers: [
    		'groups_modified(groups.splices)'
    	],
    	groups_modified: function(change){
    		console.log(JSON.stringify(change))
    		if(!change || !change.indexSplices)
    			return;
    		var m = window.canvas_manager;
    		change.indexSplices.forEach(function(s){
    			s.removed.forEach(function(group){
    				if(group.dir_rm)
	    				m.free_canvas(group.dir_rm);
	    			if(group.spa_rm)
	    				m.free_canvas(group.spa_rm);
	    			if(group.speed_rm)
	    				m.free_canvas(group.speed_rm);
    			}, this);

    			for(var ii=s.index, stop = s.index+s.addedCount; ii<stop; ii++){
    				var group = this.groups[ii];

    				// TODO: actually do this properly...
    				group.spa_rm = m.create_from_dims([128,128]);
    				group.dir_rm = m.create_from_dims([80,80]);
    				group.speed_rm = m.create_from_dims([20,100]);
    			}
    		}, this);
    	}
	});
</script>

  
</dom-module>